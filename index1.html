<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RealyMedios Radio</title>
    <style>
        /* Estilos generales */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #000; /* Fondo negro */
            color: #FFA500; /* Color ocre para el texto */
        }

        header {
            background-color: #000; /* Fondo negro */
            color: #FFA500; /* Texto ocre */
            box-shadow: 0 4px 6px rgba(255, 165, 0, 0.3); /* Sombra con tono ocre */
            padding: 10px;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        header img {
            width: 50px; /* Tamaño del logo */
            height: auto;
            margin-right: 10px;
        }

        h1 {
            margin: 0;
            font-size: 24px; /* Tamaño reducido para la cabecera */
        }

        nav {
            display: flex;
            gap: 20px;
        }

        nav a {
            text-decoration: none;
            color: #FFA500; /* Enlaces ocre */
            font-weight: bold;
        }

        main {
            margin-top: 120px; /* Espacio para el reproductor fijo */
            padding: 20px;
        }

        footer {
            text-align: center;
            padding: 20px;
            background-color: #000; /* Fondo negro */
            color: #FFA500; /* Texto ocre */
        }

        /* Galería */
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .gallery-item {
            width: 100%;
            height: auto;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .gallery-item:hover {
            transform: scale(1.05);
        }

        /* Podcasts */
        .podcast-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .podcast-item {
            background-color: #111; /* Fondo oscuro para los podcasts */
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(255, 165, 0, 0.3); /* Sombra con tono ocre */
        }

        /* Reproductor de audio */
        audio {
            background-color: #111; /* Fondo oscuro para el reproductor */
            color: #FFA500; /* Controles ocre */
        }
    </style>
</head>
<body>
    <!-- Cabecera fija con reproductor -->
    <header>
        <div style="display: flex; align-items: center;">
            <img src="logo.png" alt="Logotipo de RealyMedios Radio">
            <h1>RealyMedios Radio</h1>
        </div>
        <nav>
            <a href="#">Inicio</a>
            <a href="#">Acerca de</a>
            <a href="#">Contacto</a>
        </nav>
        <div class="media-player">
            <!-- Reproductor de Audio -->
            <audio id="mensajeAudio" src="Mensaje.mp3"></audio>
            <audio id="streamAudio" controls autoplay style="margin-top: 20px;">
                <source id="audioSource" src="" type="audio/mpeg">
                Tu navegador no soporta el reproductor de audio.
            </audio>
            <div id="metadata">Cargando información...</div>
            <div id="connections">Cargando número de conexiones...</div>
        </div>
    </header>

    <!-- Contenido principal -->
    <main>
        <h2>Tu Radio Real</h2>
        <p>Transmitiendo música variada las 24 horas del día para todos los oyentes.</p>

        <!-- Galería de fotos -->
        <section id="gallery">
            <h3>Galería de Fotos</h3>
            <div class="photo-grid">
                <img src="images/photo1.jpg" alt="Foto 1" class="gallery-item">
                <img src="images/photo2.jpg" alt="Foto 2" class="gallery-item">
                <img src="images/photo3.jpg" alt="Foto 3" class="gallery-item">
                <!-- Agrega más imágenes aquí -->
            </div>
        </section>

        <!-- Podcasts -->
        <section id="podcasts">
            <h3>Podcasts</h3>
            <div class="podcast-list">
                <div class="podcast-item">
                    <h4>Episodio 1: Introducción a la Radio</h4>
                    <audio controls>
                        <source src="podcasts/episodio1.mp3" type="audio/mpeg">
                        Tu navegador no soporta el reproductor de audio.
                    </audio>
                </div>
                <div class="podcast-item">
                    <h4>Episodio 2: Entrevista Especial</h4>
                    <audio controls>
                        <source src="podcasts/episodio2.mp3" type="audio/mpeg">
                        Tu navegador no soporta el reproductor de audio.
                    </audio>
                </div>
                <!-- Agrega más episodios aquí -->
            </div>
        </section>

        <!-- Encuesta -->
        <section id="polls">
            <h3>Encuesta</h3>
            <form id="poll-form" action="procesar-encuesta.php" method="POST">
                <p>¿Qué tipo de música prefieres?</p>
                <label><input type="radio" name="music" value="rock"> Rock</label><br>
                <label><input type="radio" name="music" value="pop"> Pop</label><br>
                <label><input type="radio" name="music" value="electronica"> Electrónica</label><br>
                <button type="submit">Votar</button>
            </form>
        </section>
    </main>

    <!-- Pie de página -->
    <footer>
        <p>Instagram: @RealyMedios</p>
        <p>TikTok: @RealyMediosRadio</p>
        <p>WhatsApp: 0412.7047374</p>
        <p>© 2025 RealyMedios Radio. Todos los derechos reservados.</p>
    </footer>

    <!-- JavaScript para cargar la URL del stream y obtener metadatos -->
    <script>
        // Elementos HTML para mostrar metadatos
        const metadataDiv = document.getElementById('metadata');
        const connectionsDiv = document.getElementById('connections');

        // Cargar la URL del stream desde stream-url.txt
        async function loadStreamUrl() {
            try {
                const response = await fetch('stream-url.txt'); // Asegúrate de que este archivo exista en tu servidor
                if (!response.ok) {
                    throw new Error(`Error al cargar stream-url.txt (código ${response.status})`);
                }
                let data = await response.text();
                let trimmedUrl = data.trim(); // Elimina espacios en blanco

                // Quitar "/stream" de la URL si existe
                if (trimmedUrl.endsWith('/stream')) {
                    trimmedUrl = trimmedUrl.slice(0, -7); // Elimina los últimos 7 caracteres ("/stream")
                }
                console.log("URL base después de quitar '/stream':", trimmedUrl);

                // Asignar la URL al reproductor de audio
                const audioSource = document.getElementById('audioSource');
                const streamAudio = document.getElementById('streamAudio');
                audioSource.src = `${trimmedUrl}/stream`; // Vuelve a agregar "/stream" para el reproductor
                streamAudio.load(); // Carga el nuevo stream
                console.log("URL cargada para el reproductor:", `${trimmedUrl}/stream`);

                // Obtener metadatos y conexiones usando la URL base
                fetchMetadataAndConnections(trimmedUrl);
            } catch (error) {
                console.error("Error al cargar la URL del stream:", error);
                metadataDiv.textContent = "No se pudo cargar la información.";
                connectionsDiv.textContent = "No se pudo cargar el número de conexiones.";
            }
        }

        // Función para obtener metadatos y número de conexiones
        async function fetchMetadataAndConnections(baseUrl) {
            if (!baseUrl) {
                console.error("No hay una URL base válida para obtener los metadatos.");
                return;
            }
            try {
                // Construir la URL completa para los metadatos
                const metadataUrl = `${baseUrl}/status-json.xsl`;
                console.log("Intentando cargar metadatos desde:", metadataUrl);

                // Hacer la solicitud directamente sin proxy
                const response = await fetch(metadataUrl);
                if (!response.ok) {
                    throw new Error(`Error al cargar los metadatos (código ${response.status})`);
                }
                const data = await response.json();

                // Mostrar metadatos
                const currentSong = data.icestats.source.title || "Información no disponible";
                metadataDiv.textContent = `Ahora sonando: ${currentSong}`;

                // Mostrar número de conexiones
                const listenerCount = data.icestats.source.listeners || 0;
                connectionsDiv.textContent = `Oyentes conectados: ${listenerCount}`;
            } catch (error) {
                console.error("Error al obtener metadatos y conexiones:", error);
                metadataDiv.textContent = "No se pudo cargar la información.";
                connectionsDiv.textContent = "No se pudo cargar el número de conexiones.";

                // Intentar otro endpoint común si el primero falla
                try {
                    const fallbackUrl = `${baseUrl}/stats`;
                    console.log("Intentando cargar metadatos desde fallback:", fallbackUrl);
                    const fallbackResponse = await fetch(fallbackUrl);
                    if (!fallbackResponse.ok) {
                        throw new Error(`Error al cargar los metadatos del fallback (código ${fallbackResponse.status})`);
                    }
                    const fallbackData = await fallbackResponse.json();

                    // Mostrar metadatos del fallback
                    const fallbackSong = fallbackData.current_song || "Información no disponible";
                    metadataDiv.textContent = `Ahora sonando: ${fallbackSong}`;

                    // Mostrar número de conexiones del fallback
                    const fallbackListeners = fallbackData.listeners || 0;
                    connectionsDiv.textContent = `Oyentes conectados: ${fallbackListeners}`;
                } catch (fallbackError) {
                    console.error("Error al obtener metadatos del fallback:", fallbackError);
                    metadataDiv.textContent = "No se pudo cargar la información.";
                    connectionsDiv.textContent = "No se pudo cargar el número de conexiones.";
                }
            }
        }

        // Actualizar metadatos cada 30 segundos
        setInterval(() => {
            loadStreamUrl(); // Recarga la URL del stream y actualiza los metadatos
        }, 30000);

        // Inicializar la carga del stream y los metadatos
        loadStreamUrl();
    </script>
</body>
</html>
